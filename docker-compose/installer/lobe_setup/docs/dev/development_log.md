# Lobe Chat Setup Tool 开发日志

## 项目概述

Lobe Chat Setup Tool 是一个用 Python 开发的交互式安装工具，用于简化 Lobe Chat 的 Docker 环境配置过程。该工具提供了友好的命令行界面，支持多语言，并能够记住用户的配置偏好。

## 项目结构

```
lobe_setup/
├── managers/              # 核心功能模块
│   ├── __init__.py
│   ├── config_manager.py  # 配置管理
│   ├── file_manager.py    # 文件下载管理
│   ├── host_manager.py    # 主机配置管理
│   ├── secret_manager.py  # 密钥生成管理
│   └── display_manager.py # 显示输出管理
├── i18n.py               # 国际化支持
├── config.py             # 全局配置管理
└── setup.py             # 主程序入口
```

## 核心功能模块

### 1. 配置管理 (ConfigManager)
- 全局配置：存储在 `~/.config/lobe-setup/config.json`
- 项目配置：存储在 `<install_dir>/.lobe-setup/config.json`
- 支持配置的持久化存储和读取

### 2. 文件管理 (FileManager)
- 负责下载必要的配置文件
- 支持进度条显示
- 自动处理文件覆盖
- 支持语言特定的配置文件

### 3. 主机配置 (HostManager)
- 支持三种部署模式：
  - 本地模式 (localhost)
  - 端口模式 (自定义端口)
  - 域名模式 (自定义域名)
- 记住用户的配置选择

### 4. 密钥管理 (SecretManager)
- 生成安全的随机密钥
- 支持多种服务的密钥生成：
  - LobeChat 认证密钥
  - Casdoor 密钥和密码
  - Minio 密码
- 优先使用 OpenSSL，失败时回退到 Python secrets

### 5. 显示管理 (DisplayManager)
- 格式化配置报告
- 显示设置摘要
- 支持反向代理配置显示
- 提供清晰的下一步操作指引

## 配置存储

### 全局配置
存储在用户目录下的 `.config/lobe-setup/config.json`，包含：
- 语言偏好
- 上次使用的安装目录
- 语言选择状态

### 项目配置
存储在安装目录下的 `.lobe-setup/config.json`，包含：
- 部署模式
- 端口号（如果使用端口模式）
- 域名（如果使用域名模式）

## 配置重置

如果需要重置用户配置，可以通过删除相应的配置文件来实现：

### 重置全局配置
删除以下文件和目录：
```bash
# 删除全局配置文件
rm -rf ~/.config/lobe-setup

# 这将重置：
# - 语言偏好
# - 上次使用的安装目录
# - 语言选择状态
```

### 重置项目配置
删除特定项目的配置：
```bash
# 删除项目配置文件
rm -rf <install_dir>/.lobe-setup

# 这将重置：
# - 部署模式选择
# - 端口配置
# - 域名配置
```

### 完全重置
如果要完全重置所有配置：
```bash
# 删除全局配置
rm -rf ~/.config/lobe-setup

# 删除项目配置
rm -rf <install_dir>/.lobe-setup

# 删除已生成的环境文件（可选）
rm -f <install_dir>/.env
```

注意：
1. 删除配置文件前请确保已备份重要信息
2. `<install_dir>` 需要替换为实际的安装目录
3. 删除配置后，下次运行安装工具时将使用默认配置

## 开发注意事项

### 1. 错误处理
- 所有文件操作都需要适当的错误处理
- 在发生错误时提供清晰的错误信息
- 支持优雅的中断处理

### 2. 国际化
- 所有用户可见的文本都应使用 i18n
- 支持动态切换语言
- 配置文件也需要考虑语言差异

### 3. 安全性
- 密钥生成使用安全的方法
- 配置文件权限管理
- 敏感信息的处理

### 4. 用户体验
- 提供清晰的进度反馈
- 记住用户的选择
- 提供详细的操作指引

## 待办事项

### 高优先级
- [ ] 添加配置验证功能
- [ ] 改进错误处理机制
- [ ] 添加配置迁移功能

### 中优先级
- [ ] 添加更多语言支持
- [ ] 实现配置备份功能
- [ ] 添加安装检查功能

### 低优先级
- [ ] 添加命令行自动补全
- [ ] 优化进度显示
- [ ] 添加详细的日志记录

## 版本历史

### v0.1.0 (2025-02-13)
- 初始版本
- 实现基本的安装功能
- 支持中英文
- 添加配置记忆功能
- 模块化重构

## 贡献指南

1. 代码风格
   - 遵循 PEP 8 规范
   - 使用类型注解
   - 添加适当的注释

2. 提交规范
   - 使用清晰的提交信息
   - 每个功能独立分支
   - 提供适当的测试

3. 文档维护
   - 及时更新文档
   - 添加示例代码
   - 记录重要的设计决策

## 常见问题

1. 配置文件位置
   - 全局配置：`~/.config/lobe-setup/config.json`
   - 项目配置：`<install_dir>/.lobe-setup/config.json`

2. 密钥生成
   - 优先使用 OpenSSL
   - 失败时使用 Python secrets 模块
   - 不同服务使用不同长度的密钥

3. 错误处理
   - 文件下载失败
   - 配置文件损坏
   - 权限问题

## 联系方式

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- Pull Requests
- Discussions
